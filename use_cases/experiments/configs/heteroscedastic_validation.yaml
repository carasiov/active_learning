# Heteroscedastic Decoder Validation Experiment
#
# Purpose: Validate heteroscedastic decoder implementation vs standard decoder
# Expected outcomes:
#   - Lower NLL on test set (proper probabilistic scoring)
#   - Similar or better MSE/MAE (mean predictions)
#   - High σ for ambiguous/noisy inputs, low σ for clean inputs
#   - Improved OOD detection via uncertainty combination

experiment:
  name: "heteroscedastic_validation"
  description: "Validate heteroscedastic decoder aleatoric uncertainty quantification"
  output_dir: "use_cases/experiments/results"

model:
  # Architecture
  encoder_type: "dense"
  decoder_type: "dense"
  latent_dim: 16
  hidden_dims: [256, 128, 64]

  # Prior configuration
  prior_type: "mixture"
  num_components: 10
  use_component_aware_decoder: true
  component_embedding_dim: 8

  # Heteroscedastic decoder (KEY FEATURE UNDER TEST)
  use_heteroscedastic_decoder: true
  sigma_min: 0.05  # Per math spec §8
  sigma_max: 0.5   # Per math spec §8

  # Classifier
  use_tau_classifier: true
  tau_smoothing_alpha: 1.0

  # Loss weights
  reconstruction_loss: "mse"
  recon_weight: 500.0
  kl_weight: 5.0
  kl_c_weight: 0.001
  label_weight: 0.0

  # Regularization
  component_diversity_weight: -0.05  # Encourage diversity
  dirichlet_alpha: 5.0
  dirichlet_weight: 1.0

training:
  batch_size: 128
  max_epochs: 50
  learning_rate: 0.001
  patience: 10
  val_split: 0.1
  random_seed: 42

data:
  dataset: "MNIST"
  num_labeled: 50  # Few-shot setting
  flatten: false

# Expected metrics to validate:
# 1. Reconstruction NLL: Should be lower than standard decoder
#    (heteroscedastic NLL = ||x - mean||²/(2σ²) + log σ)
# 2. Variance distribution:
#    - Mean σ around 0.1-0.2 (middle of [0.05, 0.5] range)
#    - Std σ > 0 (adaptive uncertainty)
#    - No collapse to bounds (not all at 0.05 or 0.5)
# 3. Variance vs error correlation:
#    - High σ for high reconstruction error (ambiguous inputs)
#    - Low σ for low reconstruction error (clean inputs)
# 4. Per-class variance:
#    - Some classes may have higher average σ (more variable)
#    - Variance should reflect true aleatoric uncertainty
